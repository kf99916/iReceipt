{"version":3,"file":"ireceipt.min.js","sources":["../../src/tax-type.js","../../src/receipt-info.js","../../src/item.js","../../src/amount.js","../../src/receipt.js"],"sourcesContent":["export default {\n    TAX: 1,\n    ZERO_TAX: 2,\n    FREE_TAX: 3,\n    SPECIAL_TAX: 4,\n    COMPOUND_TAX: 9\n};\n","import { format } from 'date-fns/esm';\n\nclass ReceiptInfo {\n    constructor(\n        number,\n        date,\n        seller,\n        buyer,\n        type,\n        carrier,\n        donationID,\n        orderno\n    ) {\n        this.number = number;\n        this.date = date;\n        this.seller = seller;\n        this.buyer = buyer;\n        this.buyer.id = this.buyer.id || '0000000000';\n        this.type = type || '07';\n        this.carrier = carrier;\n        this.donationID = donationID;\n        this.randomNumber = Math.floor(1000 + Math.random() * 9000);\n        this.orderno = orderno;\n    }\n\n    toXMLObject() {\n        let xmlObject = {\n            InvoiceNumber: this.number,\n            InvoiceDate: format(this.date, 'YYYYMMDD'),\n            InvoiceTime: format(this.date, 'hh:mm:ss'),\n            Seller: {\n                Identifier: this.seller.id,\n                Name: this.seller.name\n            },\n            Buyer: {\n                Identifier: this.buyer.id,\n                Name: this.buyer.name\n            },\n            InvoiceType: this.type,\n            DonateMark: 0,\n            PrintMark: this.carrier ? 'N' : 'Y',\n            RandomNumber: this.randomNumber\n        };\n\n        if (this.donationID) {\n            xmlObject.DonateMark = 1;\n            xmlObject.NPOBAN = this.donationID;\n        }\n\n        if (this.carrier) {\n            xmlObject.CarrierType = this.carrier.type;\n            xmlObject.CarrierId1 = this.carrier.id;\n            xmlObject.CarrierId2 = this.carrier.id;\n        }\n\n        return xmlObject;\n    }\n}\n\nexport default ReceiptInfo;\n","import TaxType from './tax-type';\n\nclass Item {\n    constructor(description, unitPrice, sequenceNumber, quantity, taxType) {\n        this.description = description;\n        this.unitPrice = parseInt(unitPrice);\n        this.sequenceNumber = sequenceNumber;\n        this.quantity = parseInt(quantity) || 1;\n        this.taxType = taxType || TaxType.TAX;\n    }\n\n    toXMLObject() {\n        return {\n            ProductItem: {\n                Description: this.description,\n                Quantity: this.quantity,\n                UnitPrice: this.unitPrice,\n                Amount: this.amount,\n                SequenceNumber: this.sequenceNumber\n            }\n        };\n    }\n\n    get amount() {\n        return this.unitPrice * this.quantity;\n    }\n}\n\nexport default Item;\n","import TaxType from './tax-type';\n\nclass Amount {\n    constructor(taxItems, freeTaxItems, zeroTaxItems) {\n        const taxRate = 0.05;\n        this.salesAmount = Math.round(\n            taxItems.reduce(\n                (amount, item) => (amount + item.amount) / (1 + taxRate),\n                0\n            )\n        );\n        this.freeTaxSalesAmount = Math.round(\n            freeTaxItems.reduce((amount, item) => amount + item.amount, 0)\n        );\n        this.zeroTaxSalesAmount = Math.round(\n            zeroTaxItems.reduce((amount, item) => amount + item.amount, 0)\n        );\n\n        const hasTax = this.salesAmount !== 0,\n            hasFreeTax = this.freeTaxSalesAmount !== 0,\n            hasZeroTax = this.zeroTaxSalesAmount !== 0;\n\n        this.taxType = TaxType.SPECIAL_TAX;\n        if (\n            (hasTax && hasFreeTax) ||\n            (hasTax && hasZeroTax) ||\n            (hasFreeTax && hasZeroTax)\n        ) {\n            this.taxType = TaxType.COMPOUND_TAX;\n        } else if (hasTax) {\n            this.taxType = TaxType.TAX;\n        } else if (hasFreeTax) {\n            this.taxType = TaxType.FREE_TAX;\n        } else if (hasZeroTax) {\n            this.taxType = TaxType.ZERO_TAX;\n        }\n        this.taxRate =\n            this.taxType === TaxType.FREE_TAX ||\n            this.taxType === TaxType.ZERO_TAX\n                ? 0\n                : taxRate;\n        this.taxAmount = Math.round(this.salesAmount * this.taxRate);\n        this.totalAmount =\n            this.salesAmount +\n            this.freeTaxSalesAmount +\n            this.zeroTaxSalesAmount +\n            this.taxAmount;\n    }\n\n    toXMLObject() {\n        return {\n            SalesAmount: this.salesAmount,\n            FreeTaxSalesAmount: this.freeTaxSalesAmount,\n            ZeroTaxSalesAmount: this.zeroTaxSalesAmount,\n            TaxType: this.taxType,\n            TaxRate: this.taxRate,\n            TaxAmount: this.taxAmount,\n            TotalAmount: this.totalAmount\n        };\n    }\n}\n\nexport default Amount;\n","import xml2js from 'xml2js';\nimport TaxType from './tax-type';\nimport ReceiptInfo from './receipt-info';\nimport Item from './item';\nimport Amount from './amount';\n\nconst defaultInvoiceAttr = {\n    xmlns: 'urn:GEINV:eInvoiceMessage:C0401:3.1',\n    'xmlns:xsi': 'http://www.w3.org/2001/XMLSchema-instance',\n    'xsi:schemaLocation': 'urn:GEINV:eInvoiceMessage:C0401:3.1 C0401.xsd'\n};\n\nclass Receipt {\n    constructor(info, items) {\n        if (!(info instanceof ReceiptInfo)) {\n            throw new TypeError('Info is not ReceiptInfo class!');\n        }\n        const invalidItems = items.filter(item => {\n            return !(item instanceof Item);\n        });\n        if (invalidItems.length > 0) {\n            throw new TypeError('Some items are not Item class!');\n        }\n\n        this.info = info;\n        this.items = items;\n        this.amount = new Amount(\n            this.taxItems,\n            this.freeTaxItems,\n            this.zeroTaxItems\n        );\n    }\n\n    // The format of the list of winners:\n    // 53925591  10510LC60123189...\n    // 53925591  10510LC60122037...\n    // The range of receipt number is the 15th position and 10 characters\n    static parseWinnersList(winnersList) {\n        return winnersList.split(/\\n|\\r\\n?/).map(winner => {\n            return winner.substr(15, 10);\n        });\n    }\n\n    // https://asana-user-private-us-east-1.s3.amazonaws.com/assets/1470352313817/469050158764958/0d7d7e6067a5c9d773b7578f68c1e6b6?AWSAccessKeyId=ASIAJYTZ4QJBKU575X7A&Expires=1512619611&Signature=S88aqo8KUTsZIarz6IU0N1Q9x3g%3D&x-amz-security-token=FQoDYXdzEIX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaDH6gsGTBYtjGkHdQOiK3A9VasWE04WPY29Z46M12cLuySvyX3MqoiAwQe4T4sSxH%2BCDfLhKhTz2N7MEgkCINQ1JHV5ib0TQ3tWfNpffOnKQquhS9vBnYceVgU%2FoMEU8ASPvWyRC%2FBbPzDiNdxbgGB1TqroJuWKb6iZT%2FmfX3TDwAls5%2BKmPA5PtJYr9A6KjV18PdIDiz6X%2FIET2yn%2FZMyjbzEqvLN3HCJWfgQLCBWxT6C3yk%2FBXWynBVQhwgZPhUtzL57hfaW77mkK3iMdFIqFciLmp3suOh8F2D4KCLu2lXJ69W2W57wZtWHr2qzkC9pFG3tMXBzL3tvys%2FN1LIKH7R8RHvB6ugeYfqnyMBLIbWKhpJYUiaXcTennivjYVkUAIGXPsIBYssu8tF0%2BKs0baWnwxwLLfY19HpFG%2FfA8IdH6WUZLTkqfT8DJ%2B29I6Pl0J3NE1Mm7cB6G2Dk%2BJ5%2Bdh7rIlYhGlXNTHjSxJjt%2FmrCXLPnQgfxazk%2Fxp6LFUchdgVANLVLuI1CYy4V%2BKDWXEHXoVGExsr2Oby61ws6nyhk9S9GLE6uxu5wE%2F3xVcQEqUBZ5ad6sJwnDdwXOMFA2Yja1Hao2co6eei0QU%3D#_=_\n    toXML() {\n        let receiptObject = {\n            $: defaultInvoiceAttr,\n            Main: this.info.toXMLObject(),\n            Details: this.items.map(item => {\n                return item.toXMLObject();\n            }),\n            Amounts: this.amount.toXMLObject()\n        };\n\n        const builder = new xml2js.Builder({\n            rootName: 'Invoice'\n        });\n        return builder.buildObject(receiptObject);\n    }\n\n    isWinning(winningNumbers) {\n        return winningNumbers.indexOf(this.info.number) !== -1;\n    }\n\n    getChineseYear() {\n        return this.info.date.getFullYear() - 1911;\n    }\n\n    getWinningMonths() {\n        let month = this.info.date.getMonth() + 1;\n        return month % 2 === 0 ? [month - 1, month] : [month, month + 1];\n    }\n\n    generateBarCodeString() {\n        return (\n            this.getChineseYear().toString() +\n            this.getMonthsInterval()[1] +\n            this.getWinningMonths()[1] +\n            this.info.number +\n            this.info.randomNumber\n        );\n    }\n\n    get taxItems() {\n        return this.items.filter(item => {\n            return item.taxType === TaxType.TAX;\n        });\n    }\n\n    get freeTaxItems() {\n        return this.items.filter(item => {\n            return item.taxType === TaxType.FREE_TAX;\n        });\n    }\n\n    get zeroTaxItems() {\n        return this.items.filter(item => {\n            return item.taxType === TaxType.ZERO_TAX;\n        });\n    }\n}\n\nexport default {\n    Receipt: Receipt,\n    ReceiptInfo: ReceiptInfo,\n    Item: Item,\n    Amount: Amount,\n    TaxType: TaxType\n};\n"],"names":["TAX","ZERO_TAX","FREE_TAX","SPECIAL_TAX","COMPOUND_TAX","constructor","number","date","seller","buyer","id","type","carrier","donationID","randomNumber","Math","floor","random","orderno","toXMLObject","InvoiceNumber","InvoiceDate","format","InvoiceTime","Seller","Identifier","Name","name","Buyer","InvoiceType","DonateMark","PrintMark","RandomNumber","NPOBAN","CarrierType","CarrierId1","CarrierId2","description","unitPrice","parseInt","sequenceNumber","quantity","taxType","ProductItem","Description","Quantity","UnitPrice","Amount","amount","SequenceNumber","round","salesAmount","reduce","freeTaxSalesAmount","zeroTaxSalesAmount","taxRate","taxAmount","totalAmount","SalesAmount","FreeTaxSalesAmount","ZeroTaxSalesAmount","TaxType","TaxRate","TaxAmount","TotalAmount","xmlns","TypeError","filter","length","info","items","taxItems","freeTaxItems","zeroTaxItems","parseWinnersList","split","map","substr","toXML","$","Main","Details","Amounts","Builder","rootName","buildObject","isWinning","indexOf","getChineseYear","getFullYear","getWinningMonths","getMonth","generateBarCodeString","toString","getMonthsInterval","Receipt","ReceiptInfo","Item"],"mappings":"yTAAA,MAAe,CACXA,IAAK,CADM,CAEXC,SAAU,CAFC,CAGXC,SAAU,CAHC,CAIXC,YAAa,CAJF,CAKXC,aAAc,CALH,CAAf,CCEA,OAAkB,CACdC,4BASE,CACE,KAAKC,MAAL,EADF,CAEE,KAAKC,IAAL,EAFF,CAGE,KAAKC,MAAL,EAHF,CAIE,KAAKC,KAAL,EAJF,CAKE,KAAKA,KAAL,CAAWC,EAAX,CAAgB,KAAKD,KAAL,CAAWC,EAAX,EAAiB,YALnC,CAME,KAAKC,IAAL,CAAY,GAAQ,IANtB,CAOE,KAAKC,OAAL,EAPF,CAQE,KAAKC,UAAL,EARF,CASE,KAAKC,YAAL,CAAoBC,KAAKC,KAAL,CAAW,IAAO,SAAKC,MAAL,EAAlB,CATtB,CAUE,KAAKC,OAAL,EACH,CAEDC,aAAc,CACV,GAAI,GAAY,CACZC,cAAe,KAAKd,MADR,CAEZe,YAAaC,QAAAA,CAAO,KAAKf,IAAZe,CAAkB,UAAlBA,CAFD,CAGZC,YAAaD,QAAAA,CAAO,KAAKf,IAAZe,CAAkB,UAAlBA,CAHD,CAIZE,OAAQ,CACJC,WAAY,KAAKjB,MAAL,CAAYE,EADpB,CAEJgB,KAAM,KAAKlB,MAAL,CAAYmB,IAFd,CAJI,CAQZC,MAAO,CACHH,WAAY,KAAKhB,KAAL,CAAWC,EADpB,CAEHgB,KAAM,KAAKjB,KAAL,CAAWkB,IAFd,CARK,CAYZE,YAAa,KAAKlB,IAZN,CAaZmB,WAAY,CAbA,CAcZC,UAAW,KAAKnB,OAAL,CAAe,GAAf,CAAqB,GAdpB,CAeZoB,aAAc,KAAKlB,YAfP,CAAhB,CA6BA,MAXI,MAAKD,UAWT,GAVI,EAAUiB,UAAV,CAAuB,CAU3B,CATI,EAAUG,MAAV,CAAmB,KAAKpB,UAS5B,EANI,KAAKD,OAMT,GALI,EAAUsB,WAAV,CAAwB,KAAKtB,OAAL,CAAaD,IAKzC,CAJI,EAAUwB,UAAV,CAAuB,KAAKvB,OAAL,CAAaF,EAIxC,CAHI,EAAU0B,UAAV,CAAuB,KAAKxB,OAAL,CAAaF,EAGxC,GACH,CAtDa,CCAlB,OAAW,CACPL,sBAAuE,CACnE,KAAKgC,WAAL,EADmE,CAEnE,KAAKC,SAAL,CAAiBC,WAFkD,CAGnE,KAAKC,cAAL,EAHmE,CAInE,KAAKC,QAAL,CAAgBF,aAAsB,CAJ6B,CAKnE,KAAKG,OAAL,CAAe,GAAW,EAAQ1C,GACrC,CAEDmB,aAAc,CACV,MAAO,CACHwB,YAAa,CACTC,YAAa,KAAKP,WADT,CAETQ,SAAU,KAAKJ,QAFN,CAGTK,UAAW,KAAKR,SAHP,CAITS,OAAQ,KAAKC,MAJJ,CAKTC,eAAgB,KAAKT,cALZ,CADV,CASV,CAED,GAAIQ,OAAJ,EAAa,CACT,MAAO,MAAKV,SAAL,CAAiB,KAAKG,QAChC,CAvBM,CCAX,OAAa,CACTpC,kBAAkD,OAE3BU,KAAKmC,KAFsB,CAC9C,KAAM,GAAU,IAAhB,CACA,KAAKC,WAAL,CAAmB,EACf,EAASC,MAAT,CACI,OAAkB,CAAC,EAAS,EAAKJ,MAAf,GAA0B,GAA1B,CADtB,CAEI,CAFJ,CADe,CAF2B,CAQ9C,KAAKK,kBAAL,CAA0B,EACtB,EAAaD,MAAb,CAAoB,OAAkB,EAAS,EAAKJ,MAApD,CAA4D,CAA5D,CADsB,CARoB,CAW9C,KAAKM,kBAAL,CAA0B,EACtB,EAAaF,MAAb,CAAoB,OAAkB,EAAS,EAAKJ,MAApD,CAA4D,CAA5D,CADsB,CAXoB,CAe9C,KAAM,GAA8B,CAArB,QAAKG,WAApB,CACI,EAAyC,CAA5B,QAAKE,kBADtB,CAEI,EAAyC,CAA5B,QAAKC,kBAFtB,CAIA,KAAKZ,OAAL,CAAe,EAAQvC,WAnBuB,CAqBzC,IAAD,EACC,IADD,EAEC,IAvByC,CAyB1C,KAAKuC,OAAL,CAAe,EAAQtC,YAzBmB,GA2B1C,KAAKsC,OAAL,CAAe,EAAQ1C,GA3BmB,GA6B1C,KAAK0C,OAAL,CAAe,EAAQxC,QA7BmB,KA+B1C,KAAKwC,OAAL,CAAe,EAAQzC,QA/BmB,EAiC9C,KAAKsD,OAAL,CACI,KAAKb,OAAL,GAAiB,EAAQxC,QAAzB,EACA,KAAKwC,OAAL,GAAiB,EAAQzC,QADzB,CAEM,CAFN,EAlC0C,CAsC9C,KAAKuD,SAAL,CAAiB,EAAW,KAAKL,WAAL,CAAmB,KAAKI,OAAnC,CAtC6B,CAuC9C,KAAKE,WAAL,CACI,KAAKN,WAAL,CACA,KAAKE,kBADL,CAEA,KAAKC,kBAFL,CAGA,KAAKE,SACZ,CAEDrC,aAAc,CACV,MAAO,CACHuC,YAAa,KAAKP,WADf,CAEHQ,mBAAoB,KAAKN,kBAFtB,CAGHO,mBAAoB,KAAKN,kBAHtB,CAIHO,QAAS,KAAKnB,OAJX,CAKHoB,QAAS,KAAKP,OALX,CAMHQ,UAAW,KAAKP,SANb,CAOHQ,YAAa,KAAKP,WAPf,CASV,CAzDQ,CCIb,KAAM,GAAqB,CACvBQ,MAAO,qCADgB,CAEvB,YAAa,2CAFU,CAGvB,qBAAsB,+CAHC,CAA3B,CAMA,OAAc,CACV5D,gBAAyB,CACrB,GAAI,EAAE,cAAF,CAAJ,CACI,KAAM,IAAI6D,UAAJ,CAAc,gCAAd,CAAN,CAEJ,KAAM,GAAe,EAAMC,MAAN,CAAa,KACvB,EAAE,cAAF,CADU,CAArB,CAGA,GAA0B,CAAtB,GAAaC,MAAjB,CACI,KAAM,IAAIF,UAAJ,CAAc,gCAAd,CAAN,CAGJ,KAAKG,IAAL,EAXqB,CAYrB,KAAKC,KAAL,EAZqB,CAarB,KAAKtB,MAAL,CAAc,MACV,KAAKuB,QADK,CAEV,KAAKC,YAFK,CAGV,KAAKC,YAHK,CAKjB;;;;AAMD,MAAOC,iBAAP,GAAqC,CACjC,MAAO,GAAYC,KAAZ,CAAkB,UAAlB,EAA8BC,GAA9B,CAAkC,KAC9B,EAAOC,MAAP,CAAc,EAAd,CAAkB,EAAlB,CADJ,CAGV;AAGDC,OAAQ,CACJ,GAAI,GAAgB,CAChBC,GADgB,CAEhBC,KAAM,KAAKX,IAAL,CAAUlD,WAAV,EAFU,CAGhB8D,QAAS,KAAKX,KAAL,CAAWM,GAAX,CAAe,KACb,EAAKzD,WAAL,EADF,CAHO,CAMhB+D,QAAS,KAAKlC,MAAL,CAAY7B,WAAZ,EANO,CAApB,CASA,KAAM,GAAU,GAAI,GAAOgE,OAAX,CAAmB,CAC/BC,SAAU,SADqB,CAAnB,CAAhB,CAGA,MAAO,GAAQC,WAAR,GACV,CAEDC,YAA0B,CACtB,MAAoD,CAAC,CAA9C,KAAeC,OAAf,CAAuB,KAAKlB,IAAL,CAAU/D,MAAjC,CACV,CAEDkF,gBAAiB,CACb,MAAO,MAAKnB,IAAL,CAAU9D,IAAV,CAAekF,WAAf,GAA+B,IACzC,CAEDC,kBAAmB,CACf,GAAI,GAAQ,KAAKrB,IAAL,CAAU9D,IAAV,CAAeoF,QAAf,GAA4B,CAAxC,CACA,MAAqB,EAAd,IAAQ,CAAR,CAAkB,CAAC,EAAQ,CAAT,GAAlB,CAAuC,GAAQ,EAAQ,CAAhB,CACjD,CAEDC,uBAAwB,CACpB,MACI,MAAKJ,cAAL,GAAsBK,QAAtB,GACA,KAAKC,iBAAL,GAAyB,CAAzB,CADA,CAEA,KAAKJ,gBAAL,GAAwB,CAAxB,CAFA,CAGA,KAAKrB,IAAL,CAAU/D,MAHV,CAIA,KAAK+D,IAAL,CAAUvD,YAEjB,CAED,GAAIyD,SAAJ,EAAe,CACX,MAAO,MAAKD,KAAL,CAAWH,MAAX,CAAkB,KACd,EAAKzB,OAAL,GAAiB,EAAQ1C,GAD7B,CAGV,CAED,GAAIwE,aAAJ,EAAmB,CACf,MAAO,MAAKF,KAAL,CAAWH,MAAX,CAAkB,KACd,EAAKzB,OAAL,GAAiB,EAAQxC,QAD7B,CAGV,CAED,GAAIuE,aAAJ,EAAmB,CACf,MAAO,MAAKH,KAAL,CAAWH,MAAX,CAAkB,KACd,EAAKzB,OAAL,GAAiB,EAAQzC,QAD7B,CAGV,CAvFS,OA0FC,CACX8F,SADW,CAEXC,aAFW,CAGXC,MAHW,CAIXlD,QAJW,CAKXc,SALW"}