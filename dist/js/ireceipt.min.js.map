{"version":3,"file":"ireceipt.min.js","sources":["../../src/js/tax-type.js","../../src/js/receipt-info.js","../../src/js/item.js","../../src/js/amount.js","../../src/js/common/utils.js","../../src/js/encode-type.js","../../src/js/aes.js","../../src/js/receipt.js"],"sourcesContent":["export default {\n    TAX: 1,\n    ZERO_TAX: 2,\n    FREE_TAX: 3,\n    SPECIAL_TAX: 4,\n    COMPOUND_TAX: 9\n};\n","import { format } from 'date-fns';\n\nclass ReceiptInfo {\n    constructor(\n        number,\n        date,\n        seller,\n        buyer,\n        type = '07',\n        carrier,\n        donationID,\n        orderno,\n        randomNumber\n    ) {\n        this.number = number;\n        this.date = date;\n        this.seller = seller;\n        this.buyer = buyer;\n        this.type = type;\n        this.carrier = carrier;\n        this.donationID = donationID;\n        this.orderno = orderno;\n        this.randomNumber =\n            randomNumber || Math.floor(1000 + Math.random() * 9000);\n    }\n\n    toXMLObject() {\n        let xmlObject = {\n            InvoiceNumber: this.number,\n            InvoiceDate: format(this.date, 'yyyyMMdd'),\n            InvoiceTime: format(this.date, 'hh:mm:ss'),\n            Seller: {\n                Identifier: this.seller.id,\n                Name: this.seller.name\n            },\n            Buyer: {\n                Identifier: this.buyer.id || '0000000000',\n                Name: this.buyer.name\n            },\n            InvoiceType: this.type,\n            DonateMark: 0,\n            PrintMark: this.carrier ? 'N' : 'Y',\n            RandomNumber: this.randomNumber\n        };\n\n        if (this.donationID) {\n            xmlObject.DonateMark = 1;\n            xmlObject.NPOBAN = this.donationID;\n        }\n\n        if (this.carrier) {\n            xmlObject.CarrierType = this.carrier.type;\n            xmlObject.CarrierId1 = this.carrier.id;\n            xmlObject.CarrierId2 = this.carrier.id;\n        }\n\n        return xmlObject;\n    }\n}\n\nexport default ReceiptInfo;\n","import TaxType from './tax-type';\n\nclass Item {\n    constructor(\n        description,\n        unitPrice,\n        sequenceNumber,\n        quantity = 1,\n        taxType = TaxType.TAX\n    ) {\n        this.description = description;\n        this.unitPrice = parseInt(unitPrice);\n        this.sequenceNumber = sequenceNumber;\n        this.quantity = parseInt(quantity);\n        this.taxType = taxType;\n    }\n\n    toXMLObject() {\n        return {\n            ProductItem: {\n                Description: this.description,\n                Quantity: this.quantity,\n                UnitPrice: this.unitPrice,\n                Amount: this.amount,\n                SequenceNumber: this.sequenceNumber\n            }\n        };\n    }\n\n    get amount() {\n        return this.unitPrice * this.quantity;\n    }\n}\n\nexport default Item;\n","import TaxType from './tax-type';\n\nclass Amount {\n    constructor(taxItems, freeTaxItems, zeroTaxItems) {\n        const taxRate = 0.05;\n        let amounts = taxItems.map(item => item.amount / (1 + taxRate));\n        this.salesAmount = Math.round(\n            amounts.reduce((amount, item) => amount + item, 0)\n        );\n        this.freeTaxSalesAmount = Math.round(\n            freeTaxItems.reduce((amount, item) => amount + item.amount, 0)\n        );\n        this.zeroTaxSalesAmount = Math.round(\n            zeroTaxItems.reduce((amount, item) => amount + item.amount, 0)\n        );\n\n        const hasTax = this.salesAmount !== 0,\n            hasFreeTax = this.freeTaxSalesAmount !== 0,\n            hasZeroTax = this.zeroTaxSalesAmount !== 0;\n\n        this.taxType = TaxType.SPECIAL_TAX;\n        if (\n            (hasTax && hasFreeTax) ||\n            (hasTax && hasZeroTax) ||\n            (hasFreeTax && hasZeroTax)\n        ) {\n            this.taxType = TaxType.COMPOUND_TAX;\n        } else if (hasTax) {\n            this.taxType = TaxType.TAX;\n        } else if (hasFreeTax) {\n            this.taxType = TaxType.FREE_TAX;\n        } else if (hasZeroTax) {\n            this.taxType = TaxType.ZERO_TAX;\n        }\n        this.taxRate =\n            this.taxType === TaxType.FREE_TAX ||\n            this.taxType === TaxType.ZERO_TAX\n                ? 0\n                : taxRate;\n        this.taxAmount = Math.round(this.salesAmount * this.taxRate);\n        this.totalAmount =\n            this.salesAmount +\n            this.freeTaxSalesAmount +\n            this.zeroTaxSalesAmount +\n            this.taxAmount;\n    }\n\n    toXMLObject() {\n        return {\n            SalesAmount: this.salesAmount,\n            FreeTaxSalesAmount: this.freeTaxSalesAmount,\n            ZeroTaxSalesAmount: this.zeroTaxSalesAmount,\n            TaxType: this.taxType,\n            TaxRate: this.taxRate,\n            TaxAmount: this.taxAmount,\n            TotalAmount: this.totalAmount\n        };\n    }\n}\n\nexport default Amount;\n","export default {\n    padZero: function(number, size) {\n        return ('000000000' + number).substr(-size);\n    },\n    repeat: function(string, times) {\n        let repeatedString = '';\n        while (times > 0) {\n            repeatedString += string;\n            times--;\n        }\n        return repeatedString;\n    }\n};\n","export default {\n    BIG5: 0,\n    UTF8: 1,\n    BASE64: 3\n};\n","import aesjs from 'aes-js';\n\nexport default {\n    encrypt: function(AESKey, plainText) {\n        if (!AESKey) {\n            throw new TypeError('AES Key is not found!');\n        }\n        const textBytes = aesjs.utils.utf8.toBytes(plainText),\n            aesCtr = new aesjs.ModeOfOperation.ctr(\n                AESKey,\n                new aesjs.Counter(5)\n            );\n\n        return aesCtr.encrypt(textBytes);\n    },\n    decrypt: function(AESKey, encryptedBytes) {\n        if (!AESKey) {\n            throw new TypeError('AES Key is not found');\n        }\n        const aesCtr = new aesjs.ModeOfOperation.ctr(\n                AESKey,\n                new aesjs.Counter(5)\n            ),\n            decryptedBytes = aesCtr.decrypt(encryptedBytes);\n\n        return aesjs.utils.utf8.fromBytes(decryptedBytes);\n    }\n};\n","import xml2js from 'xml2js';\nimport TaxType from './tax-type';\nimport ReceiptInfo from './receipt-info';\nimport Item from './item';\nimport Amount from './amount';\nimport utils from './common/utils';\nimport EncodeType from './encode-type';\nimport aes from './aes';\nimport JsBarcode from 'jsbarcode';\nimport QRCode from 'qrcode';\nimport { format } from 'date-fns';\nimport template from '../template/ireceipt.html';\n\nconst defaultInvoiceAttr = {\n        xmlns: 'urn:GEINV:eInvoiceMessage:C0401:3.1',\n        'xmlns:xsi': 'http://www.w3.org/2001/XMLSchema-instance',\n        'xsi:schemaLocation': 'urn:GEINV:eInvoiceMessage:C0401:3.1 C0401.xsd'\n    },\n    renderQRcode = function(text) {\n        return new Promise((resolve, reject) => {\n            const opts = {\n                errorCorrectionLevel: 'L',\n                version: 6\n            };\n            QRCode.toString(text, opts, (err, string) => {\n                if (err) {\n                    reject(error);\n                }\n                resolve(string);\n            });\n        });\n    };\n\nclass Receipt {\n    constructor(info, items) {\n        if (!(info instanceof ReceiptInfo)) {\n            throw new TypeError('Info is not ReceiptInfo class!');\n        }\n        const invalidItems = items.filter(item => !(item instanceof Item));\n        if (invalidItems.length > 0) {\n            throw new TypeError('Some items are not Item class!');\n        }\n\n        this.info = info;\n        this.items = items;\n        this.amount = new Amount(\n            this.taxItems,\n            this.freeTaxItems,\n            this.zeroTaxItems\n        );\n    }\n\n    // Static Methods\n    // The format of the list of winners:\n    // 53925591  10510LC60123189...\n    // 53925591  10510LC60122037...\n    // The range of receipt number is the 15th position and 10 characters\n    static parseWinnersList(winnersList) {\n        return winnersList\n            .split(/\\n|\\r\\n?/)\n            .map(winner => winner.substr(15, 10));\n    }\n\n    // Getters\n    get taxItems() {\n        return this.items.filter(item => item.taxType === TaxType.TAX);\n    }\n\n    get freeTaxItems() {\n        return this.items.filter(item => item.taxType === TaxType.FREE_TAX);\n    }\n\n    get zeroTaxItems() {\n        return this.items.filter(item => item.taxType === TaxType.ZERO_TAX);\n    }\n\n    get chineseYear() {\n        return this.info.date.getFullYear() - 1911;\n    }\n\n    get winningMonths() {\n        let month = this.info.date.getMonth() + 1;\n        return month % 2 === 0 ? [month - 1, month] : [month, month + 1];\n    }\n\n    get totalQuantity() {\n        return this.items.reduce((sum, item) => sum + item.quantity, 0);\n    }\n\n    // Methods\n    // Reference: https://www.einvoice.nat.gov.tw/home/DownLoad?fileName=1447235507091_0.zip\n    toXML() {\n        let receiptObject = {\n            $: defaultInvoiceAttr,\n            Main: this.info.toXMLObject(),\n            Details: [this.items.map(item => item.toXMLObject())],\n            Amounts: this.amount.toXMLObject()\n        };\n\n        const builder = new xml2js.Builder({\n            rootName: 'Invoice'\n        });\n        return builder.buildObject(receiptObject);\n    }\n\n    isWinning(winningNumbers) {\n        return winningNumbers.indexOf(this.info.number) !== -1;\n    }\n\n    // Reference: https://www.einvoice.nat.gov.tw/home/DownLoad?fileName=1479449792874_0.6(20161115).pdf\n    generateBarCodeString() {\n        return (\n            this.chineseYear +\n            utils.padZero(this.winningMonths[1], 2) +\n            this.info.number +\n            this.info.randomNumber\n        );\n    }\n\n    // Reference: https://www.einvoice.nat.gov.tw/home/DownLoad?fileName=1479449792874_0.6(20161115).pdf\n    generateRightQRCodeString() {\n        let qrcode = this.items.map((item, index) => {\n            let combineString = [];\n            combineString.push(index === 0 ? '**' : ':');\n            combineString.push(item.description.replace(':', '-'));\n            combineString.push(':' + item.quantity);\n            combineString.push(':' + item.unitPrice);\n            return combineString.join('');\n        });\n\n        return qrcode.join('');\n    }\n\n    generateLeftQRCodeString(\n        AESKey,\n        info = utils.repeat('*', 10),\n        encodeType = EncodeType.UTF8\n    ) {\n        if (!AESKey) {\n            throw new TypeError('AES Key is not found');\n        }\n\n        let qrcode = [],\n            dateString =\n                this.chineseYear +\n                utils.padZero(this.info.date.getMonth() + 1, 2) +\n                utils.padZero(this.info.date.getDate(), 2),\n            salesAmountHex16 = utils.padZero(\n                this.amount.salesAmount.toString(16).toUpperCase(),\n                8\n            ),\n            totalAmountHex16 = utils.padZero(\n                this.amount.totalAmount.toString(16).toUpperCase(),\n                8\n            ),\n            plainText = this.info.number + this.info.randomNumber,\n            padding = 16 - (plainText.length % 16);\n\n        plainText += utils.repeat(padding, padding);\n\n        const encryptText = Buffer.from(\n            aes.encrypt(AESKey, plainText)\n        ).toString('base64');\n\n        qrcode.push(this.info.number);\n        qrcode.push(dateString);\n        qrcode.push(this.info.randomNumber);\n        qrcode.push(salesAmountHex16);\n        qrcode.push(totalAmountHex16);\n        qrcode.push(this.info.buyer.id || utils.repeat('0', 8));\n        qrcode.push(this.info.seller.id);\n        qrcode.push(encryptText);\n        qrcode.push(':' + info);\n        qrcode.push(':' + this.items.length);\n        qrcode.push(':' + this.totalQuantity);\n        qrcode.push(':' + encodeType);\n\n        return qrcode.join('');\n    }\n\n    render(AESKey) {\n        if (!AESKey) {\n            throw new TypeError('AES Key is not found');\n        }\n\n        const promises = [\n                this.renderBarCode(),\n                this.renderLeftQRCode(AESKey),\n                this.renderRightQRCode()\n            ],\n            intlNumberFormat = new Intl.NumberFormat();\n\n        return Promise.all(promises).then(\n            ([barCode, leftQRCode, rightQRCode]) => {\n                const buyerIdHtmlString = this.info.buyer.id\n                    ? `<div class=\"buyer-identifier\">\n                        買方${this.info.buyer.id}\n                      </div>`\n                    : '';\n\n                return `${template}\n                    <div class=\"receipt\">\n                        <div class=\"einvoice-name\">\n                            ${this.info.seller.name}\n                        </div>\n                        <div class=\"receipt-title\">電子發票證明聯</div>\n                        <div class=\"receipt-year-month\">\n                            ${this.chineseYear}年\n                            ${this.winningMonths[0]}-${this.winningMonths[1]}月 \n                        </div>\n                        <div class=\"receipt-invoice-number\">\n                            ${this.info.number}\n                        </div>\n                        <div class=\"receipt-issue-time\">\n                            ${format(this.info.date, 'yyyy-MM-dd hh:mm:ss')}\n                        </div>\n                        <div class=\"receipt-random-number\">\n                            隨機碼 ${this.info.randomNumber}\n                        </div>\n                        <div class=\"receipt-amount\">\n                            總計 ${intlNumberFormat.format(\n                                this.amount.totalAmount\n                            )}\n                        </div>\n                        <div class=\"einvoice-identifier\">\n                            賣方${this.info.seller.id}\n                        </div>\n                        ${buyerIdHtmlString}\n                        <div class=\"einvoice-barcode\">${barCode}</div>\n                        <div class=\"einvoice-qrcode-left\">${leftQRCode}</div>\n                        <div class=\"einvoice-qrcode-right\">${rightQRCode}</div>\n                        <div class=\"einvoice-remark\">退貨憑電子發票證明聯正本辦理</div>\n                    </div>`;\n            }\n        );\n    }\n\n    renderBarCode() {\n        const svgObject = document.createElementNS(\n                'http://www.w3.org/2000/svg',\n                'svg'\n            ),\n            xmlSerializer = new XMLSerializer();\n\n        JsBarcode(svgObject, this.generateBarCodeString(), {\n            format: 'CODE39',\n            displayValue: false,\n            width: 0.6,\n            height: 25\n        });\n\n        return Promise.resolve(xmlSerializer.serializeToString(svgObject));\n    }\n\n    renderRightQRCode() {\n        return renderQRcode(this.generateRightQRCodeString());\n    }\n\n    renderLeftQRCode(AESKey) {\n        if (!AESKey) {\n            throw new TypeError('AES Key is not found');\n        }\n        return renderQRcode(this.generateLeftQRCodeString(AESKey));\n    }\n\n    get taxItems() {\n        return this.items.filter(item => item.taxType === TaxType.TAX);\n    }\n\n    get freeTaxItems() {\n        return this.items.filter(item => item.taxType === TaxType.FREE_TAX);\n    }\n\n    get zeroTaxItems() {\n        return this.items.filter(item => item.taxType === TaxType.ZERO_TAX);\n    }\n\n    get chineseYear() {\n        return this.info.date.getFullYear() - 1911;\n    }\n\n    get winningMonths() {\n        let month = this.info.date.getMonth() + 1;\n        return month % 2 === 0 ? [month - 1, month] : [month, month + 1];\n    }\n\n    get totalQuantity() {\n        return this.items.reduce((sum, item) => sum + item.quantity, 0);\n    }\n}\n\nexport default {\n    Receipt: Receipt,\n    ReceiptInfo: ReceiptInfo,\n    Item: Item,\n    Amount: Amount,\n    TaxType: TaxType,\n    EncodeType: EncodeType\n};\n"],"names":["TAX","ZERO_TAX","FREE_TAX","SPECIAL_TAX","COMPOUND_TAX","ReceiptInfo","constructor","number","date","seller","buyer","type","carrier","donationID","orderno","randomNumber","Math","floor","random","toXMLObject","xmlObject","InvoiceNumber","InvoiceDate","format","InvoiceTime","Seller","Identifier","id","Name","name","Buyer","InvoiceType","DonateMark","PrintMark","RandomNumber","NPOBAN","CarrierType","CarrierId1","CarrierId2","Item","description","unitPrice","sequenceNumber","quantity","taxType","TaxType","parseInt","ProductItem","Description","Quantity","UnitPrice","Amount","amount","SequenceNumber","taxItems","freeTaxItems","zeroTaxItems","round","taxRate","amounts","map","item","salesAmount","reduce","freeTaxSalesAmount","zeroTaxSalesAmount","hasTax","hasFreeTax","hasZeroTax","taxAmount","totalAmount","SalesAmount","FreeTaxSalesAmount","ZeroTaxSalesAmount","TaxRate","TaxAmount","TotalAmount","padZero","size","substr","repeat","string","times","repeatedString","BIG5","UTF8","BASE64","encrypt","AESKey","plainText","TypeError","textBytes","aesjs","utils","utf8","toBytes","aesCtr","ModeOfOperation","ctr","Counter","decrypt","encryptedBytes","decryptedBytes","fromBytes","defaultInvoiceAttr","xmlns","renderQRcode","text","Promise","resolve","reject","QRCode","toString","errorCorrectionLevel","version","err","error","Receipt","info","items","invalidItems","filter","length","parseWinnersList","winnersList","split","winner","chineseYear","getFullYear","winningMonths","month","getMonth","totalQuantity","sum","toXML","receiptObject","$","Main","Details","Amounts","builder","xml2js","Builder","rootName","buildObject","isWinning","winningNumbers","indexOf","generateBarCodeString","generateRightQRCodeString","qrcode","index","combineString","replace","join","generateLeftQRCodeString","encodeType","EncodeType","dateString","getDate","salesAmountHex16","toUpperCase","totalAmountHex16","padding","encryptText","Buffer","from","aes","push","render","promises","renderBarCode","renderLeftQRCode","renderRightQRCode","intlNumberFormat","Intl","NumberFormat","all","then","barCode","leftQRCode","rightQRCode","buyerIdHtmlString","svgObject","document","createElementNS","xmlSerializer","XMLSerializer","JsBarcode","displayValue","width","height","serializeToString"],"mappings":"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"}