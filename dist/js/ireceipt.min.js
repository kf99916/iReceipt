(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b(require('xml2js'),require('date-fns/esm')):'function'==typeof define&&define.amd?define(['xml2js','date-fns/esm'],b):a.ireceipt=b(a.xml2js,a.esm)})(this,function(a,b){'use strict';a=a&&a.hasOwnProperty('default')?a['default']:a;var c={TAX:1,ZERO_TAX:2,FREE_TAX:3,SPECIAL_TAX:4,COMPOUND_TAX:9};class d{constructor(a,b,c,d,e,f,g,h){this.number=a,this.date=b,this.seller=c,this.buyer=d,this.buyer.id=this.buyer.id||'0000000000',this.type=e||'07',this.carrier=f,this.donationID=g,this.randomNumber=Math.floor(1e3+9e3*Math.random()),this.orderno=h}toXMLObject(){let a={InvoiceNumber:this.number,InvoiceDate:b.format(this.date,'YYYYMMDD'),InvoiceTime:b.format(this.date,'hh:mm:ss'),Seller:{Identifier:this.seller.id,Name:this.seller.name},Buyer:{Identifier:this.buyer.id,Name:this.buyer.name},InvoiceType:this.type,DonateMark:0,PrintMark:this.carrier?'N':'Y',RandomNumber:this.randomNumber};return this.donationID&&(a.DonateMark=1,a.NPOBAN=this.donationID),this.carrier&&(a.CarrierType=this.carrier.type,a.CarrierId1=this.carrier.id,a.CarrierId2=this.carrier.id),a}}class e{constructor(a,b,d,e,f){this.description=a,this.unitPrice=parseInt(b),this.sequenceNumber=d,this.quantity=parseInt(e)||1,this.taxType=f||c.TAX}toXMLObject(){return{ProductItem:{Description:this.description,Quantity:this.quantity,UnitPrice:this.unitPrice,Amount:this.amount,SequenceNumber:this.sequenceNumber}}}get amount(){return this.unitPrice*this.quantity}}class f{constructor(a,b,d){var e=Math.round;const f=0.05;this.salesAmount=e(a.reduce((a,b)=>(a+b.amount)/(1+f),0)),this.freeTaxSalesAmount=e(b.reduce((a,b)=>a+b.amount,0)),this.zeroTaxSalesAmount=e(d.reduce((a,b)=>a+b.amount,0));const g=0!==this.salesAmount,h=0!==this.freeTaxSalesAmount,i=0!==this.zeroTaxSalesAmount;this.taxType=c.SPECIAL_TAX,g&&h||g&&i||h&&i?this.taxType=c.COMPOUND_TAX:g?this.taxType=c.TAX:h?this.taxType=c.FREE_TAX:i&&(this.taxType=c.ZERO_TAX),this.taxRate=this.taxType===c.FREE_TAX||this.taxType===c.ZERO_TAX?0:f,this.taxAmount=e(this.salesAmount*this.taxRate),this.totalAmount=this.salesAmount+this.freeTaxSalesAmount+this.zeroTaxSalesAmount+this.taxAmount}toXMLObject(){return{SalesAmount:this.salesAmount,FreeTaxSalesAmount:this.freeTaxSalesAmount,ZeroTaxSalesAmount:this.zeroTaxSalesAmount,TaxType:this.taxType,TaxRate:this.taxRate,TaxAmount:this.taxAmount,TotalAmount:this.totalAmount}}}const g={xmlns:'urn:GEINV:eInvoiceMessage:C0401:3.1',"xmlns:xsi":'http://www.w3.org/2001/XMLSchema-instance',"xsi:schemaLocation":'urn:GEINV:eInvoiceMessage:C0401:3.1 C0401.xsd'};class h{constructor(a,b){if(!(a instanceof d))throw new TypeError('Info is not ReceiptInfo class!');const c=b.filter((a)=>!(a instanceof e));if(0<c.length)throw new TypeError('Some items are not Item class!');this.info=a,this.items=b,this.amount=new f(this.taxItems,this.freeTaxItems,this.zeroTaxItems)}// The format of the list of winners:
// 53925591  10510LC60123189...
// 53925591  10510LC60122037...
// The range of receipt number is the 15th position and 10 characters
static parseWinnersList(a){return a.split(/\n|\r\n?/).map((a)=>a.substr(15,10))}// https://asana-user-private-us-east-1.s3.amazonaws.com/assets/1470352313817/469050158764958/0d7d7e6067a5c9d773b7578f68c1e6b6?AWSAccessKeyId=ASIAJYTZ4QJBKU575X7A&Expires=1512619611&Signature=S88aqo8KUTsZIarz6IU0N1Q9x3g%3D&x-amz-security-token=FQoDYXdzEIX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaDH6gsGTBYtjGkHdQOiK3A9VasWE04WPY29Z46M12cLuySvyX3MqoiAwQe4T4sSxH%2BCDfLhKhTz2N7MEgkCINQ1JHV5ib0TQ3tWfNpffOnKQquhS9vBnYceVgU%2FoMEU8ASPvWyRC%2FBbPzDiNdxbgGB1TqroJuWKb6iZT%2FmfX3TDwAls5%2BKmPA5PtJYr9A6KjV18PdIDiz6X%2FIET2yn%2FZMyjbzEqvLN3HCJWfgQLCBWxT6C3yk%2FBXWynBVQhwgZPhUtzL57hfaW77mkK3iMdFIqFciLmp3suOh8F2D4KCLu2lXJ69W2W57wZtWHr2qzkC9pFG3tMXBzL3tvys%2FN1LIKH7R8RHvB6ugeYfqnyMBLIbWKhpJYUiaXcTennivjYVkUAIGXPsIBYssu8tF0%2BKs0baWnwxwLLfY19HpFG%2FfA8IdH6WUZLTkqfT8DJ%2B29I6Pl0J3NE1Mm7cB6G2Dk%2BJ5%2Bdh7rIlYhGlXNTHjSxJjt%2FmrCXLPnQgfxazk%2Fxp6LFUchdgVANLVLuI1CYy4V%2BKDWXEHXoVGExsr2Oby61ws6nyhk9S9GLE6uxu5wE%2F3xVcQEqUBZ5ad6sJwnDdwXOMFA2Yja1Hao2co6eei0QU%3D#_=_
toXML(){let b={$:g,Main:this.info.toXMLObject(),Details:this.items.map((a)=>a.toXMLObject()),Amounts:this.amount.toXMLObject()};const c=new a.Builder({rootName:'Invoice'});return c.buildObject(b)}isWinning(a){return-1!==a.indexOf(this.info.number)}getChineseYear(){return this.info.date.getFullYear()-1911}getWinningMonths(){let a=this.info.date.getMonth()+1;return 0==a%2?[a-1,a]:[a,a+1]}generateBarCodeString(){return this.getChineseYear().toString()+this.getMonthsInterval()[1]+this.getWinningMonths()[1]+this.info.number+this.info.randomNumber}get taxItems(){return this.items.filter((a)=>a.taxType===c.TAX)}get freeTaxItems(){return this.items.filter((a)=>a.taxType===c.FREE_TAX)}get zeroTaxItems(){return this.items.filter((a)=>a.taxType===c.ZERO_TAX)}}return{Receipt:h,ReceiptInfo:d,Item:e,Amount:f,TaxType:c}});
//# sourceMappingURL=ireceipt.min.js.map
